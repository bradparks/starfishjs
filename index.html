<!DOCTYPE html>
<html>
    <head>
        <title>StarfishJS - Automatic tiled wallpaper generator</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <script src="starfish.js" type="text/javascript"></script>
        <script src="sf-coswave.js" type="text/javascript"></script>
        <script src="sf-spinflake.js" type="text/javascript"></script>
        <script src="sf-rangefrac.js" type="text/javascript"></script>
        <script type="text/javascript">
            // @license magnet:?xt=urn:btih:90dc5c0be029de84e523b9b3922520e79e0e6f08&dn=cc0.txt CC0
            if (!window.location.hash) {
                window.location.hash = "#!size=384";
            }

            var instance;
            var canvas;
            var ctx;

            function drawIt(ev) {
                if (ev && ev.preventDefault)
                    ev.preventDefault();
                var args = {};
                window.location.hash.replace(/^#!/,'').split('&')
                        .forEach(function(arg) {
                    var s = arg.split('=', 2);
                    if (s.length == 2)
                        args[s[0]] = s[1];
                    else if (s[0])
                        args[s[0]] = true;
                });
                if (args.test && args.test in Starfish.generators) {
                    var layer = new Starfish.generators[args.test]();
                    layer.drawToCanvas(ctx);
                    canvasToBackground();
                }
                else {
                    instance = new Starfish.Instance;
                    render(ev);
                }
            }
            function canvasToBackground() {
                var body = document.getElementsByTagName("body")[0];
                var data = canvas.toDataURL();
                body.style.background = "url(" + data + ")";

                // draw to image
                var img = document.getElementById("starfish-img");
                img.src = data;
            }
            function render(ev) {
                if (ev && ev.preventDefault)
                    ev.preventDefault();
                var args = {};
                window.location.hash.replace(/^#!/,'').split('&')
                        .forEach(function(arg) {
                    var s = arg.split('=', 2);
                    if (s.length == 2)
                        args[s[0]] = s[1];
                    else if (s[0])
                        args[s[0]] = true;
                });
                if (args.size) {
                    var dimens = args.size.split('x', 2);
                    var w = dimens[0];
                    var h;
                    if (dimens[1])
                        h = dimens[1];
                    else
                        h = w;
                    canvas.width = w;
                    canvas.height = h;
                }
                instance.render(ctx, function() {
                    canvasToBackground();
                });
            }
            function start() {
                canvas = document.getElementById("starfish");
                ctx = canvas.getContext("2d");
                var refreshLink = document.getElementById('refresh-link');
                var renderLink = document.getElementById('render-link');
                refreshLink.addEventListener('click', drawIt);
                renderLink.addEventListener('click', render);
                drawIt();
            }
            window.addEventListener('load', start);
            // @license-end
        </script>
        <style type="text/css">
            @keyframes background-drift {
                from { background-position: 0 0 }
                to   { background-position: 384px 384px}
            }
            body {
                background: #ccf;
                animation-name: background-drift;
                animation-duration: 64s;
                animation-iteration-count: infinite;
                animation-timing-function: linear;
            }
            #starfish, #starfish-img {
                border: solid 0.5em navy;
            }
            #starfish-img {
                display: none;
            }
            div {
                background-color: rgba(255,255,255,0.7);
                font-weight: 500;
                padding: 0.25em;
                width: 384px;
                font: 0.8em sans-serif;
                margin-bottom: 0.50em;
            }
            .smaller {
                font-size: 0.8em;
            }
        </style>
    </head>
    <body>
        <div>
            <p><strong>Click <a href="" id="refresh-link">here</a>
                to try a fresh pattern,
            or <a id="render-link" href="">render it again</a> (and then
        wait several seconds).</strong></p>

        <p>Right-click the boxed image to save the currently-viewed
        wallpaper as a file, and be sure that the filename ends in
        <q>.png</q>.</p>

        <p>This is StarfishJS, a JavaScript port of Starfish, which
        randomly generates a beautiful new wallpaper whenever you ask it
        to.</p>

        <p class="smaller">The original Starfish program was written in
        C by <a href="http://www.redecho.org/">Mars Saxman</a> (<a
            href="http://http.debian.net/debian/pool/main/x/xstarfish/xstarfish_1.1.orig.tar.gz">src tar</a>);
        <br />
        The version you are now viewing was translated to JavaScript by
        <a href="mailto:micah@addictivecode.org">Micah Cowan</a>.</p>

        <p class="smaller">The GitHub source repository for StarfishJS is <a
            href="https://github.com/micahcowan/starfishjs">here</a></p>
        </div>

        <img id="starfish-img" />
        <canvas id="starfish" width="384" height="384" />
    <body>
</html>
